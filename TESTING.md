# Тестирование F1 Game Bot

## Быстрый старт

1. Убедитесь, что файл `.env` настроен с вашим `BOT_TOKEN` и `ADMIN_IDS`
2. Запустите бота:
   ```bash
   source venv/bin/activate
   python bot.py
   ```

## Тестирование команд

### Для всех пользователей

#### `/start` или `/help`
- ✅ Должен показать приветственное сообщение
- ✅ Должен показать список команд
- ✅ Для админов должен показать дополнительные админ-команды

#### `/bet`
- ✅ Должен показать список открытых гонок (или сразу выбор гонщиков, если гонка одна)
- ✅ Должен позволить выбрать гонщиков для 1-го, 2-го и 3-го места
- ✅ Должен исключать уже выбранных гонщиков из списка
- ✅ Должен показать подтверждение перед сохранением
- ✅ Должен сохранить ставку

#### `/my_bets`
- ✅ Должен показать все ставки пользователя
- ✅ Должен разделить на "Upcoming" (можно изменить) и "Finished"
- ✅ Должен показать кнопки "Change" и "Delete" для открытых ставок
- ✅ Должен позволить изменить ставку
- ✅ Должен позволить удалить ставку с подтверждением

#### `/leaderboard`
- ✅ Должен показать таблицу лидеров
- ✅ Должен отсортировать по убыванию очков
- ✅ Должен показать медали для топ-3

#### `/me` или `/mystats`
- ✅ Должен показать общие очки пользователя
- ✅ Должен показать количество гонок со ставками
- ✅ Должен показать историю последних гонок с очками

### Для админов

#### `/admin_races`
- ✅ Должен показать меню управления гонками
- ✅ Должен позволить просмотреть все гонки
- ✅ Должен позволить добавить гонку (имя → дата → время)
- ✅ Должен позволить редактировать гонку
- ✅ Должен позволить удалить гонку с подтверждением

#### `/results`
- ✅ Должен показать список гонок без результатов
- ✅ Должен позволить выбрать гонщиков для 1-го, 2-го и 3-го места
- ✅ Должен исключать уже выбранных гонщиков
- ✅ Должен показать подтверждение перед сохранением
- ✅ Должен автоматически рассчитать очки для всех ставок
- ✅ Должен обновить статус гонки на "finished"
- ✅ Должен показать топ-5 игроков с их очками

## Тестовый сценарий

1. **Создание гонки (админ)**
   - Используйте `/admin_races` → "Add race"
   - Введите: "Bahrain Grand Prix", дата: "2025-03-02", время: "16:00"

2. **Создание ставки (пользователь)**
   - Используйте `/bet`
   - Выберите гонку
   - Выберите гонщиков: VER (1-е), HAM (2-е), LEC (3-е)
   - Подтвердите ставку

3. **Просмотр ставок**
   - Используйте `/my_bets`
   - Убедитесь, что ставка отображается

4. **Ввод результатов (админ)**
   - Используйте `/results`
   - Выберите гонку
   - Введите результаты: VER (1-е), HAM (2-е), LEC (3-е)
   - Подтвердите

5. **Проверка очков**
   - Используйте `/me` - должны быть 9 очков (3+3+3)
   - Используйте `/leaderboard` - должны быть в таблице

## Проверка подсчета очков

### Правила:
- **3 очка**: гонщик угадан на правильной позиции
- **1 очко**: гонщик угадан, но на неправильной позиции (все еще в топ-3)

### Примеры:

**Ставка:** VER (1-е), HAM (2-е), LEC (3-е)  
**Результат:** VER (1-е), HAM (2-е), LEC (3-е)  
**Очки:** 9 (3+3+3) ✅

**Ставка:** VER (1-е), HAM (2-е), LEC (3-е)  
**Результат:** HAM (1-е), VER (2-е), LEC (3-е)  
**Очки:** 5 (1+1+3) ✅

**Ставка:** VER (1-е), HAM (2-е), LEC (3-е)  
**Результат:** NOR (1-е), PIA (2-е), RUS (3-е)  
**Очки:** 0 ✅

## Запуск автоматических тестов

```bash
source venv/bin/activate
python test_bot.py
```

Этот скрипт проверит:
- Инициализацию базы данных
- Работу с пользователями
- Работу с гонками
- Работу со ставками
- Работу с результатами
- Подсчет очков
- Таблицу лидеров

## Известные ограничения

- Напоминания (B-010) еще не реализованы
- Загрузка календаря гонок (B-005) еще не реализована
- FSM состояния хранятся в памяти (при перезапуске бота теряются)

## Отладка

Если что-то не работает:

1. Проверьте логи бота в консоли
2. Убедитесь, что `.env` файл настроен правильно
3. Проверьте, что база данных создана: `ls -la f1bot.db`
4. Запустите тестовый скрипт: `python test_bot.py`


